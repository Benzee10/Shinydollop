
---
import type { SimilarPost } from "@utils/similar-posts";
import { getPostUrlBySlug } from "@utils/url-utils";
import ImageWrapper from "./misc/ImageWrapper.astro";
import path from "node:path";
import { getDir } from "@utils/url-utils";

interface Props {
  similarPosts: SimilarPost[];
  class?: string;
}

const { similarPosts, class: className } = Astro.props;

if (similarPosts.length === 0) {
  return null;
}
---

<div class:list={["related-gallery w-full", className]}>
  <div class="mb-6">
    <h3 class="text-2xl font-bold text-black/90 dark:text-white/90 mb-4 flex items-center gap-3">
      <div class="w-1 h-6 bg-[var(--primary)] rounded-full"></div>
      Related Galleries
    </h3>
    <p class="text-black/60 dark:text-white/60 text-sm">
      Discover more beautiful galleries you might enjoy
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {similarPosts.map((post) => (
      <a 
        href={getPostUrlBySlug(post.slug)} 
        class="group block w-full transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]"
        aria-label={`View gallery: ${post.data.title}`}
      >
        <div class="related-gallery-card card-base overflow-hidden h-full">
          <!-- Image Container -->
          <div class="relative w-full h-48 overflow-hidden">
            {post.data.image ? (
              <ImageWrapper 
                src={post.data.image} 
                basePath={path.join("content/posts/", getDir(post.slug))} 
                alt={`Cover image for ${post.data.title}`}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              />
            ) : (
              <div class="w-full h-full bg-gradient-to-br from-[var(--primary)] to-[var(--primary-darker)] opacity-80 flex items-center justify-center">
                <span class="text-white text-lg font-medium">No Preview</span>
              </div>
            )}
            
            <!-- Overlay -->
            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-all duration-300"></div>
            
            <!-- Category Badge -->
            {post.data.category && (
              <div class="absolute top-3 left-3 px-2 py-1 bg-[var(--primary)] text-white text-xs font-medium rounded-full">
                {post.data.category}
              </div>
            )}
          </div>

          <!-- Content -->
          <div class="p-4">
            <h4 class="font-bold text-black/90 dark:text-white/90 text-base line-clamp-2 mb-2 group-hover:text-[var(--primary)] transition-colors duration-300">
              {post.data.title}
            </h4>
            
            {post.data.description && (
              <p class="text-black/60 dark:text-white/60 text-sm line-clamp-2 mb-3">
                {post.data.description}
              </p>
            )}

            <!-- Tags -->
            {post.data.tags && post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-1 mb-3">
                {post.data.tags.slice(0, 3).map((tag) => (
                  <span class="px-2 py-1 bg-black/5 dark:bg-white/10 text-black/70 dark:text-white/70 text-xs rounded-md">
                    {tag}
                  </span>
                ))}
                {post.data.tags.length > 3 && (
                  <span class="px-2 py-1 bg-black/5 dark:bg-white/10 text-black/50 dark:text-white/50 text-xs rounded-md">
                    +{post.data.tags.length - 3}
                  </span>
                )}
              </div>
            )}

            <!-- View Gallery Button -->
            <div class="flex items-center justify-between mt-4">
              <span class="text-[var(--primary)] text-sm font-medium group-hover:underline">
                View Gallery â†’
              </span>
              <div class="text-xs text-black/40 dark:text-white/40">
                {new Date(post.data.published).toLocaleDateString()}
              </div>
            </div>
          </div>
        </div>
      </a>
    ))}
  </div>

  <!-- View More Link -->
  <div class="mt-8 text-center">
    <a 
      href="/" 
      class="inline-flex items-center gap-2 px-6 py-3 bg-[var(--primary)] text-white rounded-full font-medium hover:bg-[var(--primary-darker)] transition-all duration-300 hover:scale-105 active:scale-95"
    >
      <span>Explore More Galleries</span>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
      </svg>
    </a>
  </div>
</div>

<style>
.related-gallery-card {
  background: var(--card-bg);
  border: 1px solid var(--line-divider);
  transition: all 0.3s ease;
}

.related-gallery-card:hover {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  border-color: var(--primary);
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>
