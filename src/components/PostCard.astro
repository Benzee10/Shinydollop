---
import type { CollectionEntry } from "astro:content";
import path from "node:path";
import { Icon } from "astro-icon/components";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import { getDir } from "../utils/url-utils";
import ImageWrapper from "./misc/ImageWrapper.astro";
import PostMetadata from "./PostMeta.astro";

interface Props {
	class?: string;
	entry: CollectionEntry<"posts">;
	title: string;
	url: string;
	published: Date;
	updated?: Date;
	tags: string[];
	category: string | null;
	image: string;
	description: string;
	draft: boolean;
	style: string;
}
const {
	entry,
	title,
	url,
	published,
	updated,
	tags,
	category,
	image,
	description,
	style,
} = Astro.props;
const className = Astro.props.class;

const hasCover = image !== undefined && image !== null && image !== "";

const coverWidth = "28%";

const { remarkPluginFrontmatter } = await entry.render();
---
<div class:list={["gallery-card relative w-full h-80 md:h-96 rounded-[var(--radius-large)] overflow-hidden group cursor-pointer", className]} style={style}>
    <a href={url} class="block w-full h-full relative">
        <!-- Background Image -->
        {hasCover ? (
            <ImageWrapper 
                src={image} 
                basePath={path.join("content/posts/", getDir(entry.id))} 
                alt="Cover Image of the Post"
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
            />
        ) : (
            <div class="w-full h-full bg-gradient-to-br from-[var(--primary)] to-[var(--primary-darker)] opacity-80"></div>
        )}
        
        <!-- Dark Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent group-hover:from-black/90 group-hover:via-black/50 transition-all duration-300"></div>
        
        <!-- Content Overlay -->
        <div class="absolute inset-0 flex flex-col justify-end p-6 text-white">
            <!-- Category Badge -->
            {category && (
                <div class="mb-3">
                    <span class="inline-block px-3 py-1 text-xs font-semibold bg-[var(--primary)] text-white rounded-full">
                        {category}
                    </span>
                </div>
            )}
            
            <!-- Title -->
            <h2 class="text-xl md:text-2xl font-bold mb-2 leading-tight group-hover:text-[var(--primary)] transition-colors duration-300">
                {title}
            </h2>
            
            <!-- Description -->
            <p class="text-sm text-gray-200 mb-3 line-clamp-2 opacity-90">
                {description || remarkPluginFrontmatter.excerpt}
            </p>
            
            <!-- Metadata -->
            <div class="flex items-center justify-between text-xs text-gray-300">
                <div class="flex items-center gap-4">
                    <span>{published.toLocaleDateString()}</span>
                    <span>â€¢</span>
                    <span>{remarkPluginFrontmatter.minutes} min read</span>
                </div>
                
                <!-- Arrow Icon -->
                <Icon 
                    name="material-symbols:chevron-right-rounded"
                    class="text-xl transition-transform duration-300 group-hover:translate-x-1 text-[var(--primary)]"
                />
            </div>
            
            <!-- Tags -->
            {tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-1 mt-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    {tags.slice(0, 3).map(tag => (
                        <span class="px-2 py-1 text-xs bg-white/20 rounded-md backdrop-blur-sm">
                            #{tag}
                        </span>
                    ))}
                </div>
            )}
        </div>
    </a>
</div>
<div class="transition border-t-[1px] border-dashed mx-6 border-black/10 dark:border-white/[0.15] last:border-t-0 md:hidden"></div>

<style define:vars={{coverWidth}}>
</style>